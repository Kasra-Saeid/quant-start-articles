
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="google-site-verification" content="wl3-8ed1QZjI0iYZMv10zoZWYElkMObTfwLlWIj9cpA" />
    <meta name="description" content="Rough Path Theory and Signatures Applied To Quantitative Finance - Part 4">

    <link rel="icon" href="/static/images/favicon.png">

    <title>Rough Path Theory and Signatures Applied To Quantitative Finance - Part 4 | QuantStart</title>
    
    
<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,900&display=swap" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900&display=swap" rel="stylesheet"> 
<link href="/static/css/bootstrap.min.css" rel="stylesheet">
<link href="/static/css/prism.css" rel="stylesheet">
<link href="/static/css/qs.css?v=10" rel="stylesheet">
    
  </head>

  <body>
    <header class="header covered-header" style="background-image: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)), url(https://quantstartmedia.s3.amazonaws.com/images/article-images/article-backgrounds/rough-path-theory.jpg);">
  
<nav class="nav">
  <div class="container nav-container">
    <div class="nav-row row d-flex justify-content-between align-items-center">
      <div class="col-2">
        <ul class="nav-items justify-content-end small-capitals align-items-center">
          <li class="nav-item">
            <a class="link-fade" href="/">QuantStart</a>
          </li>
        </ul>
      </div>
      <div class="col-auto col-logo">
        <ul id="top-nav-menu" class="nav-items justify-content-end align-items-center">
          
          <li class="nav-item">
            <a class="link-fade" href="/qsalpha/">QSAlpha</a>
          </li>
          
          
          <li class="nav-item">
            <a class="link-fade" href="/quantcademy/">Quantcademy</a>
          </li>
          
          <li id="menu-link-ebooks" class="nav-item">
            <a class="link-fade" href="#">Books</a>
            <div id="menu-pane-ebooks" class="nav-items menu-dropdown-pane">
              <div class="nav-item">
                <a class="link-fade d-block ml-3 mr-3 my-3 mt-4" href="/successful-algorithmic-trading-ebook/">Successful Algorithmic Trading</a>
              </div>
              <div class="nav-item">
                <a class="link-fade d-block ml-3 mr-3 my-3 mt-4" href="/advanced-algorithmic-trading-ebook/">Advanced Algorithmic Trading</a>
              </div>
              <div class="nav-item">
                <a class="link-fade d-block ml-3 mr-3 my-3 mt-4" href="/cpp-for-quantitative-finance-ebook/">C++ For Quantitative Finance</a>
              </div>
            </div>
          </li>
          <li class="nav-item">
            <a class="link-fade" href="/qstrader/">QSTrader</a>
          </li>
          <li class="nav-item">
            <a class="link-fade" href="/articles/">Articles</a>
          </li>
          
          <li class="nav-item">
            <a class="link-fade" href="/members/login/">Login</a>
          </li>
          
        </ul>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
    </div>
  </div>
</nav>

<nav id="mobile-nav" class="mobile-nav text-left">
  <div class="container">
    <ul class="mt-4 ml-3 mobile-nav-menu">
      <li class="nav-item">
        <a class="link-fade d-block" href="/">QuantStart</a>
      </li>

      
      <li class="nav-item">
        <a class="link-fade d-block pt-3" href="/qsalpha/">QSAlpha</a>
      </li>
      

      
      <li class="nav-item">
        <a class="link-fade d-block pt-3" href="/quantcademy/">Quantcademy</a>
      </li>
      

      <li class="nav-item">
        <a class="link-fade d-block pt-3" href="#">Books</a>
      </li>
      <li class="nav-item sub-item">
        <a class="link-fade d-block ml-3" href="/successful-algorithmic-trading-ebook/">Successful Algorithmic Trading</a>
      </li>
      <li class="nav-item sub-item">
        <a class="link-fade d-block ml-3" href="/advanced-algorithmic-trading-ebook/">Advanced Algorithmic Trading</a>
      </li>
      <li class="nav-item sub-item">
        <a class="link-fade d-block ml-3" href="/cpp-for-quantitative-finance-ebook/">C++ For Quantitative Finance</a>
      </li>

      <li class="nav-item">
        <a class="link-fade d-block pt-3" href="/qstrader/">QSTrader</a>
      </li>

      <li class="nav-item">
        <a class="link-fade d-block pt-3" href="/articles/">Articles</a>
      </li>

      
      <li class="nav-item">
        <a class="link-fade d-block pt-3" href="/members/login/">Login</a>
      </li>
      
    </ul>
    <button class="nav-toggle mobile-nav-close">
      <svg id="mobile-nav-close-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M19.77,5.63,13.41,12l6.36,6.37a1,1,0,0,1-1.41,1.41L12,13.41,5.63,19.77a1,1,0,0,1-1.44-1.39l0,0L10.58,12,4.21,5.63a1,1,0,0,1,0-1.42,1,1,0,0,1,1.41,0l0,0L12,10.58l6.37-6.37a1,1,0,0,1,1.41,0A1,1,0,0,1,19.77,5.63Z"></path>
      </svg>
    </button>
  </div>
</nav>

  <div class="container hero-container">
    <section class="mt-5 mb-4">
      <div class="row justify-content-center">
        <div class="col-12 text-center">
          <p class="hero">Rough Path Theory and Signatures Applied To Quantitative Finance - Part 4</p>
          <p class="hero subhero">Rough Path Theory and Signatures Applied To Quantitative Finance - Part 4</p>
        </div>
      </div>
    </section>
  </div>
</header>
    
<section class="container content-container">
  <div class="row">
    <div class="col-md-8 order-md-2">
      <section class="content article-content">
        
        
        <p><em>This is the fourth in a new advanced series of posts written by Imanol Pérez, a PhD researcher in Mathematics at Oxford University and an expert guest contributor to QuantStart.</em></p>

<p><em>In this post Imanol applies the Theory of Rough Paths to the task of predicting which country a company belongs to based on the evolution of its stock price and traded volume.<br>
- Mike.</em></p>

<p>As we saw in the <a href="https://www.quantstart.com/articles/rough-path-theory-and-signatures-applied-to-quantitative-finance-part-3">last article</a>, the signature of a path can be a powerful tool to tackle machine learning problems. The previous article showed an application to a <em>toy problem</em>, but as we will see in this article rough path theory and signatures can also be used in more practical applications.</p>

<p>More specifically, we will build a model that predicts, and quite accurately in fact, which country a company belongs to using the evolution of its stock price and traded volume.</p>

<p>Obviously, the way the price of a stock changes over time varies from company to company. If a company is profitable and investors think it will still be profitable in the future, the price of its stock will probably rise. If, on the other hand, a company is near bankruptcy it is quite likely that the price will fall.</p>

<p>However, intuitively it makes sense (and this is in fact what one observes in real life) to expect that outside factors that affect the country as a whole will also have an impact on the price of a stock. Therefore, it is reasonable to think that prices of stocks that trade on the same country will have some intrinsic similarities, that go beyond the performance of each particular company.</p>

<p>The objective of this article will be to capture these similarities using signatures. We will make use of two main ingredients for this task: the daily price of the stock over a year, and the daily volume over the same period of time. We will consider stocks of three different countries: United States, United Kingdom and Germany. As we will see, the model can correctly predict the country a stock belongs to with an accuracy of 97%.</p>

<p>The companies that were used can be found in <a href="https://git.maths.ox.ac.uk/perez/identifying-which-country-is-a-stock-from/blob/master/tickers.py">this file</a>. We shall first load the data from each company:</p>

<pre>
<code class="language-python">import pandas as pd
import pandas.io.data as web

# We will consider data from 2016.
start = datetime.datetime(2016,1,1)
end = datetime.datetime(2017,1,1)

# Load data from each company.
data=[]
for country in tickers:
    print("Loading companies from "+country+"...")
    for company in tickers[country]:
        companyData=getData(company, start, end)

        # If the company doesn't have any data, ignore it.
        if len(companyData)==0: continue

        data.append(Stock(companyData, country))
    print("Done.")</code>
</pre>

<p>where the class <code>Stock</code> is given by the following:</p>

<pre>
<code class="language-python">class Stock:
    '''
    Class that contains information about a stock,
    that will later be used.
    '''

    def __init__(self, data, country):
        # Store the stream of data.
        self.data=np.array(data, dtype='float32')

        # Store the country the stock belongs to.
        self.country=country

        # Since the output to train the model must
        # be a vector, each country will be given
        # by a point, which is calculated using
        # the function country_to_point.
        self.point=country_to_point(country)


def country_to_point(country):
    '''
    Converts a country into a point
    '''
    dictionary={"US": (1,0), "UK": (-1, 0), "DE": (0,1)}
    return dictionary[country]</code>
</pre>

<p>and the function <code>getData</code> is defined as follows:</p>

<pre>
<code class="language-python">def getData(ticker, start, end):
    '''
    Gets data from the specified ticker,
    for a set time period.
    '''
    stock = web.DataReader(ticker, "google", start, end)
    values=stock[["Close", "Volume"]].reset_index().values
    for i in range(len(values)):
        values[i][0]=string2datenum(str(values[i][0]),
                        "%Y-%m-%d %H:%M:%S")
    return values</code>
</pre>

<p>Then, we divide the data into two subsets: the training set, which has 70% of the data, and the testing set, with the remaining data. The training set will be used, as the name suggests, to train the model. The testing set, on the other hand, will be useful to see how accurate our model is with out-of-sample data.</p>

<pre>
<code class="language-python"># We randomly divide the dataset into two subsets: 
# the training_set, which has the 70% of the data,
# and testing_set, with the remaining 30%.
shuffle(data)
training_set=data[0:int(0.7*len(data))]
testing_set=[company for company in data
            if company not in training_set]</code>
</pre>

<p>We may now construct the inputs and outputs that will be used to train and test the model:</p>

<pre>
<code class="language-python"># The inputs and outputs to train the model are constructed.
inputs=[company.data for company in training_set]
outputs=[company.point for company in training_set]

# Inputs and outputs to test the model are built.
inputsTEST=[company.data for company in testing_set]
outputsTEST=[company.point for company in testing_set]</code>
</pre>

<p>Finally, we run the model for different order of signatures and test the accuracy:</p>

<pre>
<code class="language-python"># We apply the model for signature orders 1 to 4.
for signature_order in range(1, 5):
    # The model is trained.
    model=sigLearn.sigLearn(order=signature_order)
    model.train(inputs, outputs)

    # We calculate the predictions.
    predictions=model.predict(inputsTEST)

    # We check the accuracy of our predictions,
    # and print it then.
    print(accuracy(predictions, outputsTEST))</code>
</pre>

<p>The whole code can be found in <a href="https://git.maths.ox.ac.uk/perez/identifying-which-country-is-a-stock-from">this repository</a>.</p>

<h2>Results</h2>

<p>If we test the model for different signature orders, we see that the best results are obtained for the signature of order 4 (see Figure 1). In this case, the model correctly predicted which country a company belongs to with an accuracy of 97%.</p>

<p style="text-align:center;">
<img width="80%" alt="Accuracy of the model" src="https://s3.amazonaws.com/quantstartmedia/images/qs-imanol-rough-path-4-accuracy.png"><br>
<strong>Fig 1 - Accuracy of the model</strong>
</p>

<h2>Article Series</h2>

<ul>
  <li><a href="https://www.quantstart.com/articles/rough-path-theory-and-signatures-applied-to-quantitative-finance-part-1">Rough Path Theory and Signatures Applied To Quantitative Finance - Part 1</a></li>
  <li><a href="https://www.quantstart.com/articles/rough-path-theory-and-signatures-applied-to-quantitative-finance-part-2">Rough Path Theory and Signatures Applied To Quantitative Finance - Part 2</a></li>
  <li><a href="https://www.quantstart.com/articles/rough-path-theory-and-signatures-applied-to-quantitative-finance-part-3">Rough Path Theory and Signatures Applied To Quantitative Finance - Part 3</a></li>
  <li><a href="https://www.quantstart.com/articles/rough-path-theory-and-signatures-applied-to-quantitative-finance-part-4">Rough Path Theory and Signatures Applied To Quantitative Finance - Part 4</a></li>
</ul>

<h2>References</h2>

<ul>
  <li><a name="ref-graham2013" href="https://arxiv.org/abs/1308.0371">[1] Graham, B. (2013) "Sparse arrays of signatures for online character recognition, <em>1308.0371</em>"</a></li>
  <li><a name="ref-kiraly2016" href="https://arxiv.org/abs/1601.08169">[2] Király, F. J. and Oberhauser, H. (2016) "Kernels for sequentially ordered data, <em>1601.08169</em>"</a></li>
</ul>
        
        
        <script async data-uid="6296c27f4b" src="https://weathered-brook-5281.ck.page/6296c27f4b/index.js"></script>
      </section>
    </div>
    <div class="col-md-4 book-card order-md-1">
      
<div class="sidebar-advert-container">
  <a href="/qsalpha/?ref=art">
    <img class="card-img-top" src="/static/images/qsalpha-sidebar-advert-small.png" alt="QSAlpha">
  </a>
  <div class="card mb-4 box-shadow">
    <div class="card-body text-center">
      <h3 class="mb-3"><a class="link-fade" href="/qsalpha/?ref=art">QSAlpha</a></h3>
      <p class="card-text medium-text mb-3">Join the QSAlpha research platform that helps fill your strategy research pipeline, diversifies your portfolio and improves your risk-adjusted returns for increased profitability.</p>
      <div class="d-flex justify-content-center align-items-center">
        <div class="btn-group">
          <a class="btn btn-padded btn-outline-primary btn-lg-cta" href="/qsalpha/?ref=art">Find Out More</a>
        </div>
      </div>
    </div>
  </div>

  <a href="/quantcademy/?ref=art">
    <img class="card-img-top" src="/static/images/quantcademy-sidebar-advert-small.png" alt="Quantcademy">
  </a>
  <div class="card mb-4 box-shadow">
    <div class="card-body text-center">
      <h3 class="mb-3"><a class="link-fade" href="/quantcademy/?ref=art">The Quantcademy</a></h3>
      <p class="card-text medium-text mb-3">Join the Quantcademy membership portal that caters to the rapidly-growing retail quant trader community and learn how to increase your strategy profitability.</p>
      <div class="d-flex justify-content-center align-items-center">
        <div class="btn-group">
          <a class="btn btn-padded btn-outline-primary btn-lg-cta" href="/quantcademy/?ref=art">Find Out More</a>
        </div>
      </div>
    </div>
  </div>

  <a href="/successful-algorithmic-trading-ebook/">
    <img class="card-img-top" src="/static/images/sat-sidebar-advert-small.png" alt="Successful Algorithmic Trading">
  </a>
  <div class="card mb-4 box-shadow">
    <div class="card-body text-center">
      <h3 class="mb-3"><a class="link-fade" href="/successful-algorithmic-trading-ebook/">Successful Algorithmic Trading</a></h3>
      <p class="card-text medium-text mb-3">How to find new trading strategy ideas and objectively assess them for your portfolio using a Python-based backtesting engine.</p>
      <div class="d-flex justify-content-center align-items-center">
        <div class="btn-group">
          <a class="btn btn-padded btn-outline-primary btn-lg-cta" href="/successful-algorithmic-trading-ebook/">Find Out More</a>
        </div>
      </div>
    </div>
  </div>

  <a href="/advanced-algorithmic-trading-ebook/">
    <img class="card-img-top" src="/static/images/aat-sidebar-advert-small.png" alt="Advanced Algorithmic Trading">
  </a>
  <div class="card mb-4 box-shadow">
    <div class="card-body text-center">
      <h3 class="mb-3"><a class="link-fade" href="/advanced-algorithmic-trading-ebook/">Advanced Algorithmic Trading</a></h3>
      <p class="card-text medium-text mb-3">How to implement advanced trading strategies using time series analysis, machine learning and Bayesian statistics with R and Python.</p>
      <div class="d-flex justify-content-center align-items-center">
        <div class="btn-group">
          <a class="btn btn-padded btn-outline-primary btn-lg-cta" href="/advanced-algorithmic-trading-ebook/">Find Out More</a>
        </div>
      </div>
    </div>
  </div>
</div>
    </div>
  </div>
</section>

    

<footer>
  <div class="container container-full">
    <section class="mt-1.5 mb-1">
      <div class="row">
        <div class="col-12 col-sm-12 col-md-6 col-xl-3 mb-1.5">
          <ul class="footer-list">
            <li class="footer-list-title">QuantStart</li>
            <li class="footer-list-link"><a class="link-fade" href="/about/">About</a></li>
            <li class="footer-list-link"><a class="link-fade" href="/articles/">Articles</a></li>
            <li class="footer-list-link"><a class="link-fade" href="/sitemap/">Sitemap</a></li>
          </ul>
        </div>

        <div class="col-12 col-sm-12 col-md-6 col-xl-3 mb-1.5">
          <ul class="footer-list">
            <li class="footer-list-title">Products</li>
            
            <li class="footer-list-link"><a class="link-fade" href="/qsalpha/">QSAlpha</a></li>
            
            
            <li class="footer-list-link"><a class="link-fade" href="/quantcademy/">Quantcademy</a></li>
            
            <li class="footer-list-link"><a class="link-fade" href="/qstrader/">QSTrader</a></li>
            <li class="footer-list-link"><a class="link-fade" href="/successful-algorithmic-trading-ebook/">Successful Algorithmic Trading</a></li>
            <li class="footer-list-link"><a class="link-fade" href="/advanced-algorithmic-trading-ebook/">Advanced Algorithmic Trading</a></li>
            <li class="footer-list-link"><a class="link-fade" href="/cpp-for-quantitative-finance-ebook/">C++ For Quantitative Finance</a></li>
          </ul>
        </div>

        <div class="col-12 col-sm-12 col-md-6 col-xl-3 mb-1.5">
          <ul class="footer-list">
            <li class="footer-list-title">Legal</li>
            <li class="footer-list-link"><a class="link-fade" href="/privacy-policy/">Privacy Policy</a></li>
            <li class="footer-list-link"><a class="link-fade" href="/terms-and-conditions/">Terms &amp; Conditions</a></li>
          </ul>
        </div>

        <div class="col-12 col-sm-12 col-md-6 col-xl-3 mb-1.5">
          <ul class="footer-list">
            <li class="footer-list-title">Social</li>
            <li class="footer-list-link"><a class="link-fade" href="https://twitter.com/quantstart">Twitter</a></li>
            <li class="footer-list-link"><a class="link-fade" href="https://www.youtube.com/channel/UCmVnnZ6Y2TrJtY1eQJN6kWA">YouTube</a></li>
          </ul>
        </div>
      </div>
    </section>

    <div class="row mb-1.5 mt-5">
      <div class="col-12 col-md-9 col-lg-8 col-xl-6">
        <div class="footer-copyright">
          <p>©2012-2023 QuarkGluon Ltd. All rights reserved.</p>
        </div>
      </div>
    </div>
  </div>
</footer>

    
<script src="/static/js/jquery-3.2.1.min.js"></script>
<script src="/static/js/prism.js.min"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/nav.js"></script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-5383959-5']);
  _gaq.push(['_trackPageview']);

  (function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


    
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="/static/js/highcharts/highcharts.js"></script>
<script type="text/javascript">
  num_colours = 10;
</script>
<script src="/static/js/statistics.js"></script>


  </body>
</html>
